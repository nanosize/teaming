<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LIFF メッセージ送信サンプル</title>
  <!-- LIFF SDK の読み込み（最新エッジ版） -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      color: #4CAF50;
    }
    input, button {
      font-size: 16px;
      padding: 8px;
      margin-top: 10px;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>LIFF メッセージ送信テスト</h1>
  <p>※ このサンプルはLINEアプリ内のトークルームから起動してください。</p>
  <input type="text" id="userMessage" placeholder="送信するメッセージを入力">
  <br>
  <button id="sendBtn" disabled>メッセージ送信</button>

  <script>
    // LIFF ID を設定（ここでは「2006848149-vz9Jw0dW」を使用）
    const LIFF_ID = '2006848149-vz9Jw0dW';

    /**
     * LIFF を初期化する関数
     * 初期化完了後、送信ボタンを有効化します。
     */
    async function initLiff() {
      try {
        console.log("LIFF 初期化を開始します...");
        // LIFF の初期化（非同期処理）
        await liff.init({ liffId: LIFF_ID });
        console.log("LIFF 初期化完了");
        window.alert("LIFF の初期化に成功しました");
        // 初期化が完了したら、送信ボタンを有効化
        document.getElementById("sendBtn").disabled = false;
      } catch (error) {
        console.error("LIFF 初期化エラー:", error);
        window.alert("LIFF 初期化に失敗しました: " + error);
      }
    }

    /**
     * ユーザーが入力したメッセージを送信する関数
     */
    async function sendMessage() {
      const msgInput = document.getElementById("userMessage");
      const text = msgInput.value.trim();
      if (!text) {
        window.alert("送信するメッセージを入力してください");
        return;
      }

      // LINE の仕様に合わせたメッセージオブジェクトを作成
      const messageObj = {
        type: "text",
        text: text
      };

      try {
        // liff.sendMessages() でメッセージを送信
        await liff.sendMessages([messageObj]);
        window.alert("メッセージ送信に成功しました！");
        // 必要に応じて LIFF ウィンドウを閉じる
        liff.closeWindow();
      } catch (error) {
        console.error("メッセージ送信エラー:", error);
        window.alert("メッセージ送信に失敗しました: " + JSON.stringify(error));
      }
    }

    // ページロード時に LIFF の初期化を実行
    window.addEventListener("load", initLiff);
    // 送信ボタンのクリックイベントに sendMessage() を登録
    document.getElementById("sendBtn").addEventListener("click", sendMessage);
  </script>
</body>
</html>
